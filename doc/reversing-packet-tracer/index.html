<!DOCTYPE html>
<html><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Reversing Packet Tracer - (&gt;&gt;=) :: mircodz</title><meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="" />

  <script src="https://mircodezorzi.github.io/js/main.js"></script>

  <link rel="preconnect" href="//fonts.gstatic.com">
  <link href="//fonts.googleapis.com/css2?family=Work+Sans&display=swap" rel="stylesheet">
  <link href="//fonts.googleapis.com/css2?family=IBM+Plex+Mono&display=swap" rel="stylesheet">

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/github.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/languages/x86asm.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/languages/cmake.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/languages/lisp.min.js"></script>
  <script charset="utf-8">
    hljs.registerLanguage("emacs-lisp", hljs.getLanguage("lisp").rawDefinition);
  </script>
  <script>hljs.initHighlightingOnLoad();</script>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-172736282-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  <link rel="stylesheet" type="text/css" media="screen" href="https://mircodezorzi.github.io/css/main.css" />
  
</head>
<body>
        <div class="content"><header>
  <div class="main">
    <a href="https://mircodezorzi.github.io/">(&gt;&gt;=) :: mircodz</a>
  </div>
  <nav>
    
      <a href="/tags/">tags</a>
    
  </nav>
</header>

<main>
  <article>
    <div class="title">
      <h1 class="title">Reversing Packet Tracer</h1>
      <div class="meta date-posted">Posted on Nov 27, 2020
      
        <div class="meta date-updated">(Updated on Feb 24, 2021)</div>
      
      </div>
    </div>

    <div class="post-tags">
      
      
      <nav class="nav tags">
        <ul class="tags">
          
          <li><a href="/tags/reversing">reversing</a></li>
          
          <li><a href="/tags/packettracer">packettracer</a></li>
          
        </ul>
      </nav>
      
      
    </div>

    
      
        <div class="hugotoc no-text-decoration">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#preface">Preface</a></li>
    <li><a href="#reversing">Reversing</a>
      <ul>
        <li><a href="#stage-1-decryptptsave">Stage 1: <code>decryptPTSave</code></a></li>
        <li><a href="#stage-2-decipher">Stage 2: <code>decipher</code></a></li>
        <li><a href="#stage-3-deobfuscatebytes">Stage 3: <code>deobfuscateBytes</code></a></li>
        <li><a href="#stage-4-quncompress">Stage 4: <code>qUncompress</code></a></li>
      </ul>
    </li>
    <li><a href="#putting-it-all-together">Putting it All Together</a></li>
    <li><a href="#other-shenanigans">Other Shenanigans</a>
      <ul>
        <li><a href="#bypassing-login">Bypassing Login</a></li>
        <li><a href="#100">100%</a></li>
      </ul>
    </li>
    <li><a href="#resources">Resources</a></li>
  </ul>
</nav>
          <a href="#" class="back-to-top">Back to top</a>
        </div>
      
      <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script type="application/javascript">(function() {
     var $window = $(window);
     if ($window.width() >= 1400) { 
         var $toc = $('#TableOfContents');
         if ($toc.length > 0) {
             function onScroll(){
                 var currentScroll = $window.scrollTop();
                 var h = $('[id^="headline"]');
                 var id = "";
                 h.each(function (i, e) {
                     e = $(e);
                     if (e.offset().top - 10 <= currentScroll) {
                         id = e.attr('id');
                     }
                 });
                 var current = $toc.find('a.current');
                 if (current.length == 1 && current.eq(0).attr('href') == '#' + id) return true;

                 current.each(function (i, e) {
                     $(e).removeClass('current').siblings('ul').hide();
                 });
                 $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                     $(e).children('a').addClass('current').siblings('ul').show();
                 });
             }
             $window.on('scroll', onScroll);
             $(document).ready(function() {
                 $toc.find('a').parent('li').find('ul').hide();
                 onScroll();
                 document.getElementsByClassName('hugotoc')[0].style.display = '';
             });}}})();</script>

    

    <section class="body">
      <div class="ox-hugo-toc toc">
<div></div>
<div class="heading">Table of Contents</div>
<ul>
<li><a href="#preface">Preface</a></li>
<li><a href="#reversing">Reversing</a>
<ul>
<li><a href="#stage-1-decryptptsave">Stage 1: <code>decryptPTSave</code></a></li>
<li><a href="#stage-2-decipher">Stage 2: <code>decipher</code></a></li>
<li><a href="#stage-3-deobfuscatebytes">Stage 3: <code>deobfuscateBytes</code></a></li>
<li><a href="#stage-4-quncompress">Stage 4: <code>qUncompress</code></a></li>
</ul>
</li>
<li><a href="#putting-it-all-together">Putting it All Together</a></li>
<li><a href="#other-shenanigans">Other Shenanigans</a>
<ul>
<li><a href="#bypassing-login">Bypassing Login</a></li>
<li><a href="#100">100%</a></li>
</ul>
</li>
<li><a href="#resources">Resources</a></li>
</ul>
</div>
<!--endtoc-->
<h2 id="preface">Preface</h2>
<p>As a high school IT student I find myself using Packet Tracer almost on a daily basis. As much as I think it&rsquo;s a great piece of software, there&rsquo;s one thing that has been bothering me since I started using it, and it&rsquo;s probably the most annoying aspect of the tool; the need to login with a cisco account each and every time. Being a lazy programmer who can&rsquo;t be bothered to enter his password every few days I set out to reverse engineer Packet Tracer and patch the binary to completely bypass the need to login.</p>
<p>Me being me, I immediately got distrarcted by a more alluring task: reversing the encoding and decoding of Packet Tracer Simulation Files.</p>
<h2 id="reversing">Reversing</h2>
<p>Thankfully Cisco developers seem to have forgotten to strip the binary&rsquo;s symbols of the Linux version, so we are going to take advantage of it; this will help up tremendously in the reversing process and it will save us a huge amount of time as we won&rsquo;t have to locate the functions that were interested in. After opening up the binary in IDA and giving it some time to analyze it we can start looking at all the declared functions inside the program. The one that stands out the most is <code>decryptFileBytes</code>; if we try to run Packet Tracer under a debugger and we add a breakpoint onto said function, opening any <code>pka</code> or <code>pkt</code> file we immediately trigger the breakepoint and will halt the program with the following backtrace:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">[#0] 0x5555589f9560 → Util::decryptFileBytes(QByteArray const&amp;, QByteArray&amp;, QString)()
[#1] 0x555558b7762f → CAppWindow::fileOpenFromBytes(QByteArray const&amp;, QString const&amp;)()
[#2] 0x555558b7b5eb → CAppWindow::fileOpen(QString)()
[#3] 0x555558b7b138 → CAppWindow::fileOpenFolder(QString const&amp;)()
[#4] 0x555558b4f646 → CAppWindow::fileOpen()()
[#5] 0x55555937a1f5 → CAppWindow::qt_static_metacall(QObject*, QMetaObject::Call, int, void**)()
[#6] 0x7fffeed0dd85 → QMetaObject::activate(QObject*, int, int, void**)()
[#7] 0x7ffff739f792 → QAction::triggered(bool)()
[#8] 0x7ffff73a1dac → QAction::activate(QAction::ActionEvent)()
[#9] 0x7ffff73a2701 → QAction::event(QEvent*)()
</code></pre></div><p>Looking at the decompiled pseudo-code generated by IDA we immediately find another three functions with really interesting names: <code>decryptPTSave</code>, <code>deobfuscateBytes</code>, and <code>qUncompress</code>. Because the function uses <code>QDomDocument</code> we can also deduce that the simulation files are actually XML files decrypted and probably obfuscated.</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="n">Util</span><span class="o">::</span><span class="n">decryptFileBytes</span><span class="p">(</span><span class="k">const</span> <span class="n">QByteArray</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="n">QByteArray</span> <span class="o">*</span><span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">QByteArray</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-50h] MAPDST
</span><span class="c1"></span>  <span class="n">QByteArray</span> <span class="n">plain</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-48h]
</span><span class="c1"></span>
  <span class="n">v2</span> <span class="o">=</span> <span class="n">a2</span><span class="p">;</span>
  <span class="n">v17</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">QDomDocument</span><span class="o">::</span><span class="n">QDomDocument</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v12</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">QDomDocument</span><span class="o">::</span><span class="n">setContent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v12</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">QByteArray</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">original</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">QArrayData</span><span class="o">::</span><span class="n">shared_null</span><span class="p">;</span>
    <span class="n">Util</span><span class="o">::</span><span class="n">decryptPTSave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span> <span class="c1">// buf = decryptedPTSave(input)
</span><span class="c1"></span>    <span class="n">QByteArray</span><span class="o">::~</span><span class="n">QByteArray</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!*</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">QByteArray</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
    <span class="n">Util</span><span class="o">::</span><span class="n">deobfuscateBytes</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span> <span class="c1">// second parameter won&#39;t be used here
</span><span class="c1"></span>    <span class="n">v5</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">qUncompress</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">var_50</span><span class="p">);</span>
    <span class="n">v6</span> <span class="o">=</span> <span class="o">*</span><span class="n">v2</span><span class="p">;</span>
    <span class="o">*</span><span class="n">v2</span> <span class="o">=</span> <span class="o">*</span><span class="n">plain</span><span class="p">;</span>
    <span class="o">*</span><span class="n">plain</span> <span class="o">=</span> <span class="n">v6</span><span class="p">;</span>
    <span class="n">QByteArray</span><span class="o">::~</span><span class="n">QByteArray</span><span class="p">(</span><span class="n">plain</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!*</span><span class="p">(</span><span class="o">*</span><span class="n">v2</span> <span class="o">+</span> <span class="mi">4LL</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// fail
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="c1">// parse xml document
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><p>One little detail that might stand out when reading the decompiled code is that the program seems to call the <code>QByteArray</code> destructor on <code>buf</code> before ever reading from it after the decrypted result has been started in it, which is really weird. Looking at the disassembly we discovered that this is just an error in the decompiled, caused by the weird memory management. What actually happens is that the address of <code>input</code> is stored in <code>r12</code>, then <code>buf</code> and <code>input</code> are swapped on the stack, after which the destructor is called on the address inside of <code>r12</code>, which is still <code>input</code>.</p>
<pre><code class="language-x86asm" data-lang="x86asm">.text:00000000034A55A9                 mov     rax, cs:_ZN10QArrayData11shared_nullE_ptr
.text:00000000034A55B0                 lea     r12, [rsp+68h+var_50] ; var_50 = input of decryptPTSave
.text:00000000034A55B5                 mov     rsi, rbp
.text:00000000034A55B8                 lea     r14, [rsp+68h+var_60]
.text:00000000034A55BD                 mov     rdi, r12
.text:00000000034A55C0                 mov     [rsp+68h+var_60], rax ; var_60 = output of decryptPTSave
.text:00000000034A55C5                 call    _ZN4Util13decryptPTSaveERK10QByteArray ; Util::decryptPTSave(QByteArray const&amp;)
.text:00000000034A55CA                 mov     rax, [rsp+68h+var_60]
.text:00000000034A55CF                 mov     rdx, [rsp+68h+var_50]
.text:00000000034A55D4                 mov     rdi, r12
.text:00000000034A55D7                 lea     r14, [rsp+68h+var_60]
.text:00000000034A55DC                 mov     [rsp+68h+var_60], rdx ; swap var_50 and var_60
.text:00000000034A55E1                 mov     [rsp+68h+var_50], rax
.text:00000000034A55E6                 call    _ZN10QByteArrayD2Ev ; QByteArray::~QByteArray()
.text:00000000034A55EB                 mov     rax, [rsp+68h+var_60]
.text:00000000034A55F0                 mov     edx, [rax+4]
.text:00000000034A55F3                 test    edx, edx
.text:00000000034A55F5                 jz      loc_34A5870
.text:00000000034A55FB
.text:00000000034A55FB loc_34A55FB:
.text:00000000034A55FB                 mov     rdi, r14 ; r14 = output of decryptPTSave
.text:00000000034A55FE                 call    _ZN4Util16deobfuscateBytesER10QByteArray ; Util::deobfuscateBytes(QByteArray &amp;)
.text:00000000034A5603                 mov     rsi, [rsp+68h+var_60] ; var_60 = input of qUncompress
.text:00000000034A5608                 lea     rbp, [rsp+68h+var_48] ; var_48 = output of qUncompress
.text:00000000034A560D                 mov     rdi, rbp        ; unsigned __int8 *
.text:00000000034A5610                 mov     edx, [rsi+4]
.text:00000000034A5613                 add     rsi, [rsi+10h]  ; int
.text:00000000034A5617                 call    __Z11qUncompressPKhi ; qUncompress(uchar const*,int)
.text:00000000034A561C                 mov     rdx, qword ptr [rsp+68h+var_48] ; rdx now contains our decrypted input string
</code></pre><h3 id="stage-1-decryptptsave">Stage 1: <code>decryptPTSave</code></h3>
<p>The first of the three functions of interest is <code>decryptPTSave</code> , an intermediary function which calls <code>Util::decrypt&lt;CryptoPP::Twofish&gt;</code>, forwarding it it&rsquo;s parameters together with 137 and 16, which we&rsquo;ll soon discover are the values of the key and initialization vectors.</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">_QWORD</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="n">Util</span><span class="o">::</span><span class="n">decryptPTSave</span><span class="p">(</span><span class="n">QByteArray</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="k">const</span> <span class="n">QByteArray</span> <span class="o">*</span><span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// ST08_8
</span><span class="c1"></span>  <span class="n">_QWORD</span> <span class="o">*</span><span class="n">v1</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>
  <span class="n">v2</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="n">Util</span><span class="o">::</span><span class="n">decrypt</span><span class="o">&lt;</span><span class="n">CryptoPP</span><span class="o">::</span><span class="n">Twofish</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="mi">137u</span><span class="p">,</span> <span class="mi">16u</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">)</span> <span class="o">==</span> <span class="n">v2</span> <span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">a1</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">v1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Analyzing <code>Util::decrypt&lt;CryptoPP::Twofish&gt;</code> we find our first layer of obfuscation.</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">_QWORD</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="n">Util</span><span class="o">::</span><span class="n">decrypt</span><span class="o">&lt;</span><span class="n">CryptoPP</span><span class="o">::</span><span class="n">Twofish</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="o">*</span><span class="n">a2</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="n">key_value</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="n">iv_value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">length</span><span class="p">;</span> <span class="c1">// ebx
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// ebp
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">offset</span><span class="p">;</span> <span class="c1">// rdx
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">data</span><span class="p">;</span> <span class="c1">// [rsp+10h] [rbp-78h] MAPDST
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">key</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-68h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">iv</span><span class="p">;</span> <span class="c1">// [rsp+30h] [rbp-58h]
</span><span class="c1"></span>
  <span class="c1">// ...
</span><span class="c1"></span>
  <span class="n">v18</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">QByteArray</span><span class="o">::</span><span class="n">QByteArray</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">v5</span> <span class="o">=</span> <span class="o">*</span><span class="n">a2</span><span class="p">;</span>
  <span class="n">length</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">length</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">do</span>
    <span class="p">{</span>
      <span class="n">v11</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">v5</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="p">(</span><span class="n">length</span> <span class="o">+</span> <span class="o">~</span><span class="n">i</span><span class="p">))</span> <span class="o">^</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">length</span><span class="p">);</span> <span class="c1">// v11 = data[length - i - 1] ^ (length - i * length)
</span><span class="c1"></span>      <span class="c1">// Qt5 buffer size checks...
</span><span class="c1"></span>      <span class="n">offset</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
      <span class="n">v10</span> <span class="o">=</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
      <span class="o">*</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="n">v10</span><span class="p">)</span> <span class="o">=</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// buf[i] = v11
</span><span class="c1"></span>      <span class="n">v5</span> <span class="o">=</span> <span class="o">*</span><span class="n">a2</span><span class="p">;</span>
      <span class="n">length</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="n">memset_s</span><span class="p">(</span><span class="o">&amp;</span><span class="n">key</span><span class="p">,</span> <span class="mi">16LL</span><span class="p">,</span> <span class="n">key_value</span><span class="p">,</span> <span class="mi">16LL</span><span class="p">);</span> <span class="c1">// 137
</span><span class="c1"></span>  <span class="n">memset_s</span><span class="p">(</span><span class="o">&amp;</span><span class="n">iv</span><span class="p">,</span> <span class="mi">16LL</span><span class="p">,</span> <span class="n">iv_value</span><span class="p">,</span> <span class="mi">16LL</span><span class="p">);</span>   <span class="c1">// 16
</span><span class="c1"></span>  <span class="n">Util</span><span class="o">::</span><span class="n">decipher</span><span class="o">&lt;</span><span class="n">CryptoPP</span><span class="o">::</span><span class="n">Twofish</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v15</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iv</span><span class="p">);</span>
  <span class="o">*</span><span class="n">a1</span> <span class="o">=</span> <span class="n">v15</span><span class="p">;</span>
  <span class="n">v15</span> <span class="o">=</span> <span class="n">QArrayData</span><span class="o">::</span><span class="n">shared_null</span><span class="p">;</span>
  <span class="n">QByteArray</span><span class="o">::~</span><span class="n">QByteArray</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v15</span><span class="p">);</span>
  <span class="n">QByteArray</span><span class="o">::~</span><span class="n">QByteArray</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>
  <span class="c1">// try-catch block ...
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">v1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>We can rewrite the frist <code>do-while</code> loop in a neat <code>for</code> loop:</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">processed</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="sc">&#39;\0&#39;</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">processed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">input</span><span class="p">[</span><span class="n">length</span> <span class="o">+</span> <span class="o">~</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">length</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h3 id="stage-2-decipher">Stage 2: <code>decipher</code></h3>
<p>Moving to <code>Util::decipher</code>, we have finally reach the bottom of this rabbit hole. I won&rsquo;t bother to include the entire decompiled function as it is quite straightforward. It takes a <code>QByteArray</code>, a key, and an initialization vector; it decrypts the input using the <code>CryptoPP</code> library, returning a second <code>QByteArray</code> containing our decrypted input.</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">QByteArray</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="n">Util</span><span class="o">::</span><span class="n">decipher</span><span class="o">&lt;</span><span class="n">CryptoPP</span><span class="o">::</span><span class="n">Twofish</span><span class="o">&gt;</span><span class="p">(</span><span class="n">QByteArray</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a2</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="n">iv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span>  <span class="n">CryptoPP</span><span class="o">::</span><span class="n">EAX_Base</span><span class="o">::</span><span class="n">EAX_Base</span><span class="p">(</span><span class="o">&amp;</span><span class="n">decryptor</span><span class="p">);</span>
  <span class="c1">// ...
</span><span class="c1"></span>  <span class="n">CryptoPP</span><span class="o">::</span><span class="n">SimpleKeyingInterface</span><span class="o">::</span><span class="n">SetKeyWithIV</span><span class="p">(</span><span class="o">&amp;</span><span class="n">decryptor</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">16uLL</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="mi">16uLL</span><span class="p">);</span>
  <span class="c1">// ...
</span><span class="c1"></span>  <span class="n">CryptoPP</span><span class="o">::</span><span class="n">AuthenticatedDecryptionFilter</span><span class="o">::</span><span class="n">AuthenticatedDecryptionFilter</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">decryptor</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="mi">16LL</span><span class="p">,</span> <span class="mh">0xFFFFFFFFLL</span><span class="p">,</span> <span class="mi">5LL</span><span class="p">);</span>
  <span class="n">CryptoPP</span><span class="o">::</span><span class="n">StringSource</span><span class="o">::</span><span class="n">StringSource</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stringsource</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">16LL</span><span class="p">)</span> <span class="o">+</span> <span class="o">*</span><span class="n">a2</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">4LL</span><span class="p">),</span> <span class="mi">1LL</span><span class="p">,</span> <span class="n">filter</span><span class="p">);</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><h3 id="stage-3-deobfuscatebytes">Stage 3: <code>deobfuscateBytes</code></h3>
<p>This second function iterates over the entire buffer and xors each byte with the size of the buffer relative it&rsquo;s position.</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">QByteArray</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="n">Util</span><span class="o">::</span><span class="n">deobfuscateBytes</span><span class="p">(</span><span class="n">QByteArray</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">QByteArray</span> <span class="o">*</span><span class="n">unused</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">QByteArray</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">length</span><span class="p">;</span> <span class="c1">// edx
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// ebx
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">offset</span><span class="p">;</span> <span class="c1">// rcx
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// bp
</span><span class="c1"></span>
  <span class="n">ptr</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
  <span class="n">length</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">4LL</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">length</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">do</span>
    <span class="p">{</span>
      <span class="n">v2</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">offset</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">ptr</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// offset of the data relative to ptr
</span><span class="c1"></span>      <span class="n">v8</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span> <span class="c1">// char v8 = buf[i] ^ sizeof(buf) - i
</span><span class="c1"></span>      <span class="c1">// Qt5 buffer size checks...
</span><span class="c1"></span>      <span class="o">++</span><span class="n">i</span><span class="p">;</span>
      <span class="o">*</span><span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">=</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// buf[i] = v8
</span><span class="c1"></span>      <span class="n">ptr</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
      <span class="n">length</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">4LL</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Converting it into a neater form in C++:</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">output</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h3 id="stage-4-quncompress">Stage 4: <code>qUncompress</code></h3>
<p>Lucky for us, the last step of the decoding function is quite trivial. <code>qUncompress</code> is a Qt5 function, and after a quick glance at the library&rsquo;s' documentation we discovered that it takes in a <code>QByteBuffer</code> and decompresses its contents using zlib. The only catch to it is that the first 4 bytes of the buffer must contain the size of the decompressed data, so we can write a small function to calculate the output size and discard the unneeded bytes.</p>
<h2 id="putting-it-all-together">Putting it All Together</h2>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">/// \brief Reimplementation of qUncompress
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">uncompress</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nbytes</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span>
                    <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
                    <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span>  <span class="mi">8</span><span class="p">)</span>
                    <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>      <span class="p">);</span>

  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">&gt;</span> <span class="n">buf</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>

  <span class="c1">// call zlibs&#39; uncompress
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="o">::</span><span class="n">uncompress</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="n">data</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">nbytes</span> <span class="o">-</span> <span class="mi">4</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="n">Z_OK</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle error gracefully...
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">data</span><span class="p">()));</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">decrypt</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">)</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">key</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span> <span class="p">};</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">iv</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>  <span class="o">=</span> <span class="p">{</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span> <span class="p">};</span>

  <span class="k">typename</span> <span class="n">CryptoPP</span><span class="o">::</span><span class="n">EAX</span><span class="o">&lt;</span><span class="n">CryptoPP</span><span class="o">::</span><span class="n">TwoFish</span><span class="o">&gt;::</span><span class="n">Decryption</span> <span class="n">d</span><span class="p">;</span>
  <span class="n">d</span><span class="p">.</span><span class="n">SetKeyWithIV</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">iv</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">iv</span><span class="p">));</span>

  <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">input</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">processed</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="sc">&#39;\0&#39;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span><span class="p">;</span>

  <span class="c1">// Stage 1 - deobfuscation
</span><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">processed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">input</span><span class="p">[</span><span class="n">length</span> <span class="o">+</span> <span class="o">~</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">length</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Stage 2 - decryption
</span><span class="c1"></span>  <span class="n">CryptoPP</span><span class="o">::</span><span class="n">StringSource</span> <span class="n">ss</span><span class="p">(</span><span class="n">processed</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span>
    <span class="k">new</span> <span class="n">CryptoPP</span><span class="o">::</span><span class="n">AuthenticatedDecryptionFilter</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="k">new</span> <span class="n">CryptoPP</span><span class="o">::</span><span class="n">StringSink</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
  <span class="p">);</span>

  <span class="c1">// Stage 3 - deobfuscation
</span><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">output</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Stage 4 - decompression
</span><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">decompressed</span> <span class="o">=</span> <span class="n">uncompress</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span> <span class="n">output</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="k">return</span> <span class="n">decompressed</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>And if we want to reverse the process:</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">/// \brief Reimplementation of qCompress
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">compress</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nbytes</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span> <span class="o">=</span> <span class="n">nbytes</span> <span class="o">+</span> <span class="n">nbytes</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">13</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">&gt;</span> <span class="n">buf</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>

  <span class="n">buf</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">len</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>

  <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="o">::</span><span class="n">compress2</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">data</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">nbytes</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="n">Z_OK</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="n">res</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// need to shrink buffer to appropriate size after compression
</span><span class="c1"></span>  <span class="n">buf</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">len</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>

  <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbytes</span> <span class="o">&amp;</span> <span class="mh">0xff000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">;</span>
  <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbytes</span> <span class="o">&amp;</span> <span class="mh">0x00ff0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
  <span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbytes</span> <span class="o">&amp;</span> <span class="mh">0x0000ff00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">buf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbytes</span> <span class="o">&amp;</span> <span class="mh">0x000000ff</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span> <span class="n">buf</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="p">}</span>

<span class="c1">/// TODO documentation
</span><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Algorithm</span><span class="o">&gt;</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">encrypt</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">key</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span> <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">iv</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>  <span class="o">=</span> <span class="p">{</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span> <span class="p">};</span>

  <span class="k">typename</span> <span class="n">CryptoPP</span><span class="o">::</span><span class="n">EAX</span><span class="o">&lt;</span><span class="n">CryptoPP</span><span class="o">::</span><span class="n">TwoFish</span><span class="o">&gt;::</span><span class="n">Encryption</span> <span class="n">e</span><span class="p">;</span>
  <span class="n">e</span><span class="p">.</span><span class="n">SetKeyWithIV</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">iv</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">iv</span><span class="p">));</span>

  <span class="c1">// Stage 1 - compression
</span><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">compressed</span> <span class="o">=</span> <span class="n">compress</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span> <span class="n">input</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

  <span class="c1">// Stage 2 - obfuscation
</span><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">compressed</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">compressed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">compressed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">compressed</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Stage 3 - encryption
</span><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">encrypted</span><span class="p">;</span>
  <span class="n">CryptoPP</span><span class="o">::</span><span class="n">StringSource</span> <span class="n">ss</span><span class="p">(</span><span class="n">compressed</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span>
    <span class="k">new</span> <span class="n">CryptoPP</span><span class="o">::</span><span class="n">AuthenticatedEncryptionFilter</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="k">new</span> <span class="n">CryptoPP</span><span class="o">::</span><span class="n">StringSink</span><span class="p">(</span><span class="n">encrypted</span><span class="p">))</span>
  <span class="p">);</span>

  <span class="c1">// Stage 4 - obfuscation
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">encrypted</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="sc">&#39;\0&#39;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">encrypted</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">output</span><span class="p">[</span><span class="n">length</span> <span class="o">+</span> <span class="o">~</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">encrypted</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">length</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="other-shenanigans">Other Shenanigans</h2>
<h3 id="bypassing-login">Bypassing Login</h3>
<p>TODO everything</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">1606495110527~K501UW~{a46d0802-d1d6-4341-adf4-3acacef612cb}~a0a1523a-a35b-41a7-b8ad-4cdc9f70e3f0~1615148676
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">v143</span> <span class="o">=</span> <span class="mi">2LL</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">v218</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v218</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v143</span> <span class="o">=</span> <span class="mi">2LL</span><span class="p">,</span> <span class="o">!</span><span class="n">CAppWindow</span><span class="o">::</span><span class="n">IS_PTSA</span><span class="p">)</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">QWidget</span><span class="o">::</span><span class="n">hide</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v284</span><span class="p">);</span>
  <span class="n">v180</span> <span class="o">=</span> <span class="p">(</span><span class="n">CNetspaceLogin</span> <span class="o">*</span><span class="p">)</span><span class="k">operator</span> <span class="k">new</span><span class="p">(</span><span class="mh">0x80uLL</span><span class="p">);</span>
  <span class="n">CNetspaceLogin</span><span class="o">::</span><span class="n">CNetspaceLogin</span><span class="p">(</span><span class="n">v180</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
</code></pre></div><p>1500 lines prior</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">v40</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)</span><span class="n">isAuthenticated</span><span class="p">()</span> <span class="o">^</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kr">__int64</span> <span class="nf">isAuthenticated</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span>
  <span class="n">v37</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">QHostInfo</span><span class="o">::</span><span class="n">localHostName</span><span class="p">(</span><span class="o">&amp;</span><span class="n">local_hostname</span><span class="p">);</span>
  <span class="n">QCoreApplication</span><span class="o">::</span><span class="n">applicationFilePath</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v36</span><span class="p">);</span>
  <span class="n">QFileInfo</span><span class="o">::</span><span class="n">QFileInfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v29</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v36</span><span class="p">);</span>
  <span class="n">v0</span> <span class="o">=</span> <span class="n">v36</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!*</span><span class="n">v36</span> <span class="o">||</span> <span class="o">*</span><span class="n">v36</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v1</span> <span class="o">=</span> <span class="n">_InterlockedSub</span><span class="p">(</span><span class="n">v36</span><span class="p">,</span> <span class="mi">1u</span><span class="p">),</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">v36</span><span class="p">,</span> <span class="o">!</span><span class="n">v1</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">QArrayData</span><span class="o">::</span><span class="n">deallocate</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="mi">2LL</span><span class="p">,</span> <span class="mi">8LL</span><span class="p">);</span>
  <span class="n">QFileInfo</span><span class="o">::</span><span class="n">absolutePath</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v36</span><span class="p">);</span>
  <span class="n">QFileInfo</span><span class="o">::</span><span class="n">QFileInfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v30</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v36</span><span class="p">);</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="n">v36</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!*</span><span class="n">v36</span> <span class="o">||</span> <span class="o">*</span><span class="n">v36</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v3</span> <span class="o">=</span> <span class="n">_InterlockedSub</span><span class="p">(</span><span class="n">v36</span><span class="p">,</span> <span class="mi">1u</span><span class="p">),</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">v36</span><span class="p">,</span> <span class="o">!</span><span class="n">v3</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">QArrayData</span><span class="o">::</span><span class="n">deallocate</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="mi">2LL</span><span class="p">,</span> <span class="mi">8LL</span><span class="p">);</span>
  <span class="n">QFileInfo</span><span class="o">::</span><span class="n">created</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v36</span><span class="p">);</span>
  <span class="n">v24</span> <span class="o">=</span> <span class="n">QDateTime</span><span class="o">::</span><span class="n">toMSecsSinceEpoch</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v36</span><span class="p">);</span>
  <span class="n">QDateTime</span><span class="o">::~</span><span class="n">QDateTime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v36</span><span class="p">);</span>
  <span class="n">getAuthenicationFilePath</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
  <span class="n">QFile</span><span class="o">::</span><span class="n">QFile</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v36</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="n">v60</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!*</span><span class="n">v60</span> <span class="o">||</span> <span class="o">*</span><span class="n">v60</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v5</span> <span class="o">=</span> <span class="n">_InterlockedSub</span><span class="p">(</span><span class="n">v60</span><span class="p">,</span> <span class="mi">1u</span><span class="p">),</span> <span class="n">v4</span> <span class="o">=</span> <span class="n">v60</span><span class="p">,</span> <span class="o">!</span><span class="n">v5</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">QArrayData</span><span class="o">::</span><span class="n">deallocate</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="mi">2LL</span><span class="p">,</span> <span class="mi">8LL</span><span class="p">);</span>
</code></pre></div><p>Inline strlen generated by Qt which fallsback to using standard strlen.</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">if</span> <span class="p">(</span> <span class="n">QFile</span><span class="o">::</span><span class="n">exists</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v36</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v6</span> <span class="o">=</span> <span class="n">QFile</span><span class="o">::</span><span class="n">open</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v36</span><span class="p">,</span> <span class="mi">1LL</span><span class="p">),</span> <span class="n">v6</span><span class="p">)</span> <span class="p">)</span> <span class="c1">// open $HOME/packettracer/nets
</span><span class="c1"></span><span class="p">{</span>
  <span class="n">QIODevice</span><span class="o">::</span><span class="n">readAll</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
  <span class="n">Util</span><span class="o">::</span><span class="n">decryptLog</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v31</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
  <span class="n">QByteArray</span><span class="o">::~</span><span class="n">QByteArray</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">QByteArray</span><span class="o">::</span><span class="n">isNull</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v31</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v34</span> <span class="o">=</span> <span class="n">QArrayData</span><span class="o">::</span><span class="n">shared_null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">v31</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">v31</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v14</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">v31</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v14</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">v15</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">data</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="k">do</span>
          <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">v14</span> <span class="o">==</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="o">++</span><span class="n">v15</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">while</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">v15</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">QString</span><span class="o">::</span><span class="n">fromUtf8_helper</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v34</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>   <span class="c1">// creates a qstring given a const char* and length
</span><span class="c1"></span>  <span class="p">}</span>
</code></pre></div><p>After reading /nets file, split the string and check each element</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">v60</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromAscii_helper</span><span class="p">(</span><span class="s">&#34;~&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v11</span><span class="p">);</span>
<span class="n">QString</span><span class="o">::</span><span class="n">split</span><span class="p">(</span><span class="n">v32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v34</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v60</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">1LL</span><span class="p">);</span>  <span class="c1">// v32 is a QStringList
</span><span class="c1"></span><span class="n">QString</span><span class="o">::~</span><span class="n">QString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
<span class="n">QString</span><span class="o">::~</span><span class="n">QString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v34</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">12LL</span><span class="p">)</span> <span class="o">-</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">)</span>   <span class="c1">// v32 + 12 and v32 + 8 must be the pointers to the beginig and end?
</span><span class="c1"></span><span class="p">{</span>                                           <span class="c1">// check for length &gt; 2?
</span><span class="c1"></span>  <span class="n">QList</span><span class="o">&lt;</span><span class="n">QString</span><span class="o">&gt;::</span><span class="n">detach</span><span class="p">(</span><span class="n">v32</span><span class="p">);</span>
  <span class="n">v70</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span> <span class="o">*</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span><span class="p">)</span> <span class="o">+</span> <span class="mi">40</span><span class="p">);</span> <span class="c1">// (40 - 16) / 8 = 3
</span><span class="c1"></span>  <span class="n">QtPrivate</span><span class="o">::</span><span class="n">RefCount</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">v70</span><span class="p">);</span>            <span class="c1">// tracking id
</span><span class="c1"></span>  <span class="n">QList</span><span class="o">&lt;</span><span class="n">QString</span><span class="o">&gt;::</span><span class="n">detach</span><span class="p">(</span><span class="n">v32</span><span class="p">);</span>
  <span class="n">v60</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span> <span class="o">*</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span> <span class="c1">// + 16 = first
</span><span class="c1"></span>  <span class="n">QtPrivate</span><span class="o">::</span><span class="n">RefCount</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">v60</span><span class="p">);</span>
  <span class="n">v27</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">toLongLong</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
  <span class="n">QString</span><span class="o">::~</span><span class="n">QString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
  <span class="n">v16</span> <span class="o">=</span> <span class="n">v32</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">12LL</span><span class="p">)</span> <span class="o">-</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="n">QString</span><span class="o">&gt;::</span><span class="n">detach</span><span class="p">(</span><span class="n">v32</span><span class="p">);</span>
    <span class="n">v34</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span> <span class="o">*</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span><span class="p">)</span> <span class="o">+</span> <span class="mi">48</span><span class="p">);</span> <span class="c1">// + 48 = fifth
</span><span class="c1"></span>    <span class="n">QtPrivate</span><span class="o">::</span><span class="n">RefCount</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">v34</span><span class="p">);</span>
    <span class="n">v21</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">toLongLong</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v34</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="n">QDateTime</span><span class="o">::</span><span class="n">currentDateTime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
    <span class="n">v26</span> <span class="o">=</span> <span class="n">v21</span> <span class="o">-</span> <span class="n">QDateTime</span><span class="o">::</span><span class="n">toSecsSinceEpoch</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span> <span class="c1">// check expiry against current date
</span><span class="c1"></span>    <span class="n">QDateTime</span><span class="o">::~</span><span class="n">QDateTime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
    <span class="n">QString</span><span class="o">::~</span><span class="n">QString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v34</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">v26</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">v60</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromAscii_helper</span><span class="p">(</span><span class="o">&amp;</span><span class="n">src</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="n">v16</span><span class="p">);</span>
  <span class="n">v17</span> <span class="o">=</span> <span class="n">COptions</span><span class="o">::</span><span class="n">getMainOptions</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
  <span class="n">v18</span> <span class="o">=</span> <span class="n">getLogonTimeString</span><span class="p">();</span>               <span class="c1">// runs whoami &amp; last
</span><span class="c1"></span>  <span class="n">nets_hostname</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v60</span><span class="p">;</span>
  <span class="n">v25</span> <span class="o">=</span> <span class="n">COptions</span><span class="o">::</span><span class="n">isLoginTimeMatch</span><span class="p">(</span><span class="n">v17</span><span class="p">,</span> <span class="n">v18</span><span class="p">);</span>
  <span class="n">QString</span><span class="o">::~</span><span class="n">QString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v24</span> <span class="o">==</span> <span class="n">v27</span>
    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">QList</span><span class="o">&lt;</span><span class="n">QString</span><span class="o">&gt;::</span><span class="n">detach</span><span class="p">(</span><span class="n">v32</span><span class="p">),</span>
        <span class="n">nets_hostname</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span> <span class="o">*</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span><span class="p">)</span> <span class="o">+</span> <span class="mi">24</span><span class="p">),</span> <span class="c1">// + 24 = second
</span><span class="c1"></span>        <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="n">nets_hostname</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">local_hostname</span><span class="p">))</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Util</span><span class="o">::</span><span class="n">getAppInstallIdString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span> <span class="c1">// installation id != tracking id
</span><span class="c1"></span>    <span class="n">QList</span><span class="o">&lt;</span><span class="n">QString</span><span class="o">&gt;::</span><span class="n">detach</span><span class="p">(</span><span class="n">v32</span><span class="p">);</span>
    <span class="n">nets_hostname</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v60</span><span class="p">;</span>
    <span class="n">v22</span> <span class="o">=</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span> <span class="o">*</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">v32</span> <span class="o">+</span> <span class="mi">8LL</span><span class="p">)</span> <span class="o">+</span> <span class="mi">32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span> <span class="c1">// + 32 = third
</span><span class="c1"></span>    <span class="n">QString</span><span class="o">::~</span><span class="n">QString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
    <span class="n">v20</span> <span class="o">=</span> <span class="n">v22</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">1606495110527~K501UW~{a46d0802-d1d6-4341-adf4-3acacef612cb}~a0a1523a-a35b-41a7-b8ad-4cdc9f70e3f0~1615148676
|             |       |                                     |                                    |
last login    |       |                                     |                                    |
              hostname|                                     |                                    |
                      installation id                       |                                    |
                                                            tracking id                          |
                                                                                                 expiry date
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++">      <span class="k">else</span>
      <span class="p">{</span>
        <span class="n">v20</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">LOBYTE</span><span class="p">(</span><span class="n">v20</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">v26</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">v20</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v20</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">v70</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">v26</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">v25</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="n">v23</span> <span class="o">=</span> <span class="n">CAnalyticsTracker</span><span class="o">::</span><span class="n">getInstance</span><span class="p">(</span><span class="n">nets_hostname</span><span class="p">);</span>
          <span class="n">v60</span> <span class="o">=</span> <span class="n">v70</span><span class="p">;</span>
          <span class="n">QtPrivate</span><span class="o">::</span><span class="n">RefCount</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">v70</span><span class="p">);</span>
          <span class="n">CAnalyticsTracker</span><span class="o">::</span><span class="n">setUsername</span><span class="p">(</span><span class="n">v23</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
          <span class="n">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="n">QString</span><span class="o">::~</span><span class="n">QString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v60</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          <span class="n">v6</span> <span class="o">=</span> <span class="n">v20</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">QString</span><span class="o">::~</span><span class="n">QString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v70</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">QFileDevice</span><span class="o">::</span><span class="n">close</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v36</span><span class="p">);</span>
    <span class="n">v7</span> <span class="o">=</span> <span class="n">v6</span> <span class="o">^</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="n">QString</span><span class="o">&gt;::~</span><span class="n">QList</span><span class="p">(</span><span class="n">v32</span><span class="p">);</span>
    <span class="n">QByteArray</span><span class="o">::~</span><span class="n">QByteArray</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v31</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>                                          <span class="c1">// if ( *(*v32 + 12LL) - *(*v32 + 8LL) &gt; 2 )
</span><span class="c1"></span>  <span class="p">{</span>
    <span class="n">v7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">QFile</span><span class="o">::~</span><span class="n">QFile</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v36</span><span class="p">);</span>
  <span class="n">QFileInfo</span><span class="o">::~</span><span class="n">QFileInfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v30</span><span class="p">);</span>
  <span class="n">QFileInfo</span><span class="o">::~</span><span class="n">QFileInfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v29</span><span class="p">);</span>
  <span class="n">v8</span> <span class="o">=</span> <span class="n">local_hostname</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!*</span><span class="n">local_hostname</span> <span class="o">||</span> <span class="o">*</span><span class="n">local_hostname</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v9</span> <span class="o">=</span> <span class="n">_InterlockedSub</span><span class="p">(</span><span class="n">local_hostname</span><span class="p">,</span> <span class="mi">1u</span><span class="p">),</span> <span class="n">v8</span> <span class="o">=</span> <span class="n">local_hostname</span><span class="p">,</span> <span class="o">!</span><span class="n">v9</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">QArrayData</span><span class="o">::</span><span class="n">deallocate</span><span class="p">(</span><span class="n">v8</span><span class="p">,</span> <span class="mi">2LL</span><span class="p">,</span> <span class="mi">8LL</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">v7</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kr">__int64</span> <span class="nf">getLogonTimeString</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span>
  <span class="n">v75</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">v54</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v56</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">_M_construct</span><span class="o">&lt;</span><span class="kt">char</span> <span class="k">const</span><span class="o">*&gt;</span><span class="p">(</span>
    <span class="o">&amp;</span><span class="n">v54</span><span class="p">,</span>
    <span class="s">&#34;whoami&#34;</span><span class="p">);</span>
  <span class="n">GetStdoutFromCommand</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v46</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v54</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v54</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">v56</span> <span class="p">)</span>
    <span class="k">operator</span> <span class="k">delete</span><span class="p">(</span><span class="n">v54</span><span class="p">);</span>
  <span class="n">v55</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">LOBYTE</span><span class="p">(</span><span class="n">v56</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v54</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v56</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">reserve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v54</span><span class="p">,</span> <span class="n">v47</span> <span class="o">+</span> <span class="mi">14</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="mh">0x7FFFFFFFFFFFFFFFLL</span> <span class="o">-</span> <span class="n">v55</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mh">0xD</span> <span class="p">)</span>
    <span class="n">std</span><span class="o">::</span><span class="n">__throw_length_error</span><span class="p">(</span><span class="s">&#34;basic_string::append&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">_M_append</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v54</span><span class="p">,</span> <span class="s">&#34;last -1 -R -F &#34;</span><span class="p">,</span> <span class="mi">14LL</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">_M_append</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v54</span><span class="p">,</span> <span class="n">v46</span><span class="p">,</span> <span class="n">v47</span><span class="p">);</span>
  <span class="n">GetStdoutFromCommand</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v49</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v54</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// ...
</span><span class="c1"></span>    <span class="n">v45</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromAscii_helper</span><span class="p">(</span><span class="s">&#34;^.*</span><span class="se">\\</span><span class="s">s[0-9][0-9]:[0-9][0-9]:[0-9][0-9]</span><span class="se">\\</span><span class="s">s.*$&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">qword_28</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v14</span><span class="p">);</span>
    <span class="n">QRegExp</span><span class="o">::</span><span class="n">QRegExp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v44</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v45</span><span class="p">,</span> <span class="mi">1LL</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
    <span class="n">v5</span> <span class="o">=</span> <span class="n">v45</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><p>It works!</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">foobar~foobar~foobar~foobar~1615148676
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">60 * 60 * 24 * 30 * 3 = 7,776,000 ~ 1615148676 - (1606495110527 / 1000)
</code></pre></div><h3 id="100">100%</h3>
<p>TODO</p>
<pre><code class="language-x86asm" data-lang="x86asm">.text:0000000000DFF5C0 ; Activity::CTreeNode::setCheck(bool)
.text:0000000000DFF5C0                 public _ZN8Activity9CTreeNode8setCheckEb
.text:0000000000DFF5C0 _ZN8Activity9CTreeNode8setCheckEb:      ; CODE XREF: Activity::CShapeTest::checkComparatorTree(Activity::CTreeNode *,Activity::CComparable *)+2907↑p
.text:0000000000DFF5C0                                         ; Activity::CShapeTest::checkComparatorTree(Activity::CTreeNode *,Activity::CComparable *)+2AFA↑p ...
.text:0000000000DFF5C0 ; __unwind {
.text:0000000000DFF5C0                 mov     esi, 2
.text:0000000000DFF5C5                 jmp     near ptr _ZN8Activity9CTreeNode12setCheckTypeENS_10ECheckTypeE+1 ; Activity::CTreeNode::setCheckType(Activity::ECheckType)
.text:0000000000DFF5C5 ; ---------------------------------------------------------------------------
.text:0000000000DFF5CA                 db 0FFh
.text:0000000000DFF5CB                 db 0FFh
.text:0000000000DFF5CC                 db  0Fh
.text:0000000000DFF5CD                 db  1Fh
.text:0000000000DFF5CE                 db  40h ; @
.text:0000000000DFF5CF                 db    0
.text:0000000000DFF5D0 ; ---------------------------------------------------------------------------
.text:0000000000DFF5D0                 mov     esi, 2
.text:0000000000DFF5D5                 jmp     _ZN8Activity9CTreeNode12setCheckTypeENS_10ECheckTypeE ; Activity::CTreeNode::setCheckType(Activity::ECheckType)
.text:0000000000DFF5D5 ; } // starts at DFF5C0
.text:0000000000DFF5DA ; ---------------------------------------------------------------------------
.text:0000000000DFF5DA                 nop     word ptr [rax+rax+00h]
.text:0000000000DFF5E0
</code></pre><h2 id="resources">Resources</h2>
<ul>
<li><a href="https://github.com/mircodezorzi/pka2xml/blob/master/decompiled/decipher.cpp">decipher.cpp</a></li>
<li><a href="https://github.com/mircodezorzi/pka2xml/blob/master/decompiled/decrypt.cpp">decrypt.cpp</a></li>
<li><a href="https://github.com/mircodezorzi/pka2xml/blob/master/decompiled/decryptFileBytes.cpp">decryptFileBytes.cpp</a></li>
<li><a href="https://github.com/mircodezorzi/pka2xml/blob/master/decompiled/deobfuscateBytes.cpp">deobfuscateBytes.cpp</a></li>
</ul>

    </section>
  </article>
</main>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script type="application/javascript">(function() {
     var $window = $(window);
     if ($window.width() >= 1400) { 
         var $toc = $('#TableOfContents');
         if ($toc.length > 0) {
             function onScroll(){
                 var currentScroll = $window.scrollTop();
                 var h = $('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6, .h-feed h2');
                 var id = "";
                 h.each(function (i, e) {
                     e = $(e);
                     if (e.offset().top - 10 <= currentScroll) {
                         id = e.attr('id');
                     }
                 });
                 var current = $toc.find('a.current');
                 if (current.length == 1 && current.eq(0).attr('href') == '#' + id) return true;

                 current.each(function (i, e) {
                     $(e).removeClass('current').siblings('ul').hide();
                 });
                 $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                     $(e).children('a').addClass('current').siblings('ul').show();
                 });
             }
             $window.on('scroll', onScroll);
             $(document).ready(function() {
                 $toc.find('a').parent('li').find('ul').hide();
                 onScroll();
                 document.getElementsByClassName('hugotoc')[0].style.display = '';
             });}}})();</script>








<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-172736282-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</div>
    </body>
</html>
